<!DOCTYPE html>
<html lang="en">
<head>
    <title>Digital Oil Lamp - One Room</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { background: black; margin: 0; padding: 0; }
        .lamp { cursor: pointer; height: 120px; width: auto; transition: transform 0.3s; }
        .lamp:hover { transform: scale(1.05); }
        .container { margin-top: 50px; }
        .status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .green { background: #4CAF50; animation: pulse 2s infinite; }
        .red { background: #f44336; }
        @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }
    </style>
</head>
<body>

<!-- Simple Status Indicator -->
<div class="status">
    <span class="dot" id="statusDot"></span>
    <span id="statusText">Connecting...</span>
</div>

<!-- Lamps Container -->
<div class="container text-center">
    <div id="lampsContainer"></div>
</div>

<script>
    // =================== FIREBASE SETUP ===================
    // REPLACE THESE VALUES FROM YOUR FIREBASE CONSOLE
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY_HERE",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // =================== SIMPLE LAMP SYSTEM ===================
    const TOTAL_LAMPS = 12;
    let lampStates = [0,0,0,0,0,0,0,0,0,0,0,0]; // All lamps start OFF

    // Simple status update
    function updateStatus(text, color) {
        document.getElementById('statusDot').className = 'dot ' + color;
        document.getElementById('statusText').textContent = text;
    }

    // Initialize Firebase connection
    function setupFirebase() {
        updateStatus('Connecting...', 'red');

        // Reference to the single room
        const lampsRef = database.ref('single_room/lamps');

        // Listen for changes
        lampsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && Array.isArray(data)) {
                lampStates = data;
                updateAllLampsUI();
                updateStatus('Connected', 'green');
            }
        });

        // Set initial data if not exists
        lampsRef.once('value').then((snapshot) => {
            if (!snapshot.exists()) {
                lampsRef.set(lampStates);
            }
        });
    }

    // Toggle lamp and send to Firebase
    function toggleLamp(index) {
        const newState = lampStates[index] === 1 ? 0 : 1;

        // Update Firebase (this automatically updates everyone)
        database.ref('single_room/lamps/' + index).set(newState)
            .catch(error => {
                console.error('Error:', error);
                updateStatus('Error - Check Console', 'red');
            });
    }

    // Update all lamps on screen
    function updateAllLampsUI() {
        for (let i = 0; i < TOTAL_LAMPS; i++) {
            const lamp = document.getElementById(`lamp${i}`);
            if (lamp) {
                lamp.src = lampStates[i] === 1 ? 't-lamp.gif' : 'lamp.png';
            }
        }
    }

    // Create lamp images
    function createLamps() {
        const container = document.getElementById('lampsContainer');

        for (let i = 0; i < TOTAL_LAMPS; i++) {
            // Create lamp
            const lamp = document.createElement('img');
            lamp.id = `lamp${i}`;
            lamp.className = 'lamp m-3';
            lamp.src = lampStates[i] === 1 ? 't-lamp.gif' : 'lamp.png';
            lamp.alt = `Lamp ${i+1}`;
            lamp.onclick = () => toggleLamp(i);

            container.appendChild(lamp);

            // Add line break every 4 lamps
            if ((i + 1) % 4 === 0) {
                container.appendChild(document.createElement('br'));
            }
        }
    }

    // Initialize everything when page loads
    document.addEventListener('DOMContentLoaded', () => {
        createLamps();
        setupFirebase();
    });
</script>
</body>
</html>